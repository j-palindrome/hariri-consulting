function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/enableLiveMode-Cs5eyLSQ.js","assets/stega.browser-CJ5dsYcC.js","assets/components-DEPq4dSd.js","assets/jsx-runtime-7ou52q_D.js","assets/stegaEncodeSourceMap-BbGkQV0O.js"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{_ as ft}from"./components-DEPq4dSd.js";import{g as lt,r as Y}from"./jsx-runtime-7ou52q_D.js";var De={};const ht=Symbol("values"),dt=Symbol("kStorage"),gt=Symbol("kStorages"),yt=Symbol("kTransformer"),pt=Symbol("kTTL"),mt=Symbol("kOnDedupe"),wt=Symbol("kOnError"),vt=Symbol("kOnHit"),bt=Symbol("kOnMiss"),St=Symbol("kStale");var Et={kValues:ht,kStorage:dt,kStorages:gt,kTransfromer:yt,kTTL:pt,kOnDedupe:mt,kOnError:wt,kOnHit:vt,kOnMiss:bt,kStale:St},le={exports:{}};(function(r,e){const{hasOwnProperty:t}=Object.prototype,n=E();n.configure=E,n.stringify=n,n.default=n,e.stringify=n,e.configure=E,r.exports=n;const i=/[\u0000-\u001f\u0022\u005c\ud800-\udfff]|[\ud800-\udbff](?![\udc00-\udfff])|(?:[^\ud800-\udbff]|^)[\udc00-\udfff]/;function s(d){return d.length<5e3&&!i.test(d)?`"${d}"`:JSON.stringify(d)}function a(d){if(d.length>200)return d.sort();for(let p=1;p<d.length;p++){const b=d[p];let x=p;for(;x!==0&&d[x-1]>b;)d[x]=d[x-1],x--;d[x]=b}return d}const c=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function y(d){return c.call(d)!==void 0&&d.length!==0}function g(d,p,b){d.length<b&&(b=d.length);const x=p===","?"":" ";let k=`"0":${x}${d[0]}`;for(let A=1;A<b;A++)k+=`${p}"${A}":${x}${d[A]}`;return k}function o(d){if(t.call(d,"circularValue")){const p=d.circularValue;if(typeof p=="string")return`"${p}"`;if(p==null)return p;if(p===Error||p===TypeError)return{toString(){throw new TypeError("Converting circular structure to JSON")}};throw new TypeError('The "circularValue" argument must be of type string or the value null or undefined')}return'"[Circular]"'}function u(d,p){let b;if(t.call(d,p)&&(b=d[p],typeof b!="boolean"))throw new TypeError(`The "${p}" argument must be of type boolean`);return b===void 0?!0:b}function h(d,p){let b;if(t.call(d,p)){if(b=d[p],typeof b!="number")throw new TypeError(`The "${p}" argument must be of type number`);if(!Number.isInteger(b))throw new TypeError(`The "${p}" argument must be an integer`);if(b<1)throw new RangeError(`The "${p}" argument must be >= 1`)}return b===void 0?1/0:b}function l(d){return d===1?"1 item":`${d} items`}function m(d){const p=new Set;for(const b of d)(typeof b=="string"||typeof b=="number")&&p.add(String(b));return p}function v(d){if(t.call(d,"strict")){const p=d.strict;if(typeof p!="boolean")throw new TypeError('The "strict" argument must be of type boolean');if(p)return b=>{let x=`Object can not safely be stringified. Received type ${typeof b}`;throw typeof b!="function"&&(x+=` (${b.toString()})`),new Error(x)}}}function E(d){d={...d};const p=v(d);p&&(d.bigint===void 0&&(d.bigint=!1),"circularValue"in d||(d.circularValue=Error));const b=o(d),x=u(d,"bigint"),k=u(d,"deterministic"),A=h(d,"maximumDepth"),T=h(d,"maximumBreadth");function L(N,f,w,S,_,R){let $=f[N];switch(typeof $=="object"&&$!==null&&typeof $.toJSON=="function"&&($=$.toJSON(N)),$=S.call(f,N,$),typeof $){case"string":return s($);case"object":{if($===null)return"null";if(w.indexOf($)!==-1)return b;let O="",P=",";const I=R;if(Array.isArray($)){if($.length===0)return"[]";if(A<w.length+1)return'"[Array]"';w.push($),_!==""&&(R+=_,O+=`
${R}`,P=`,
${R}`);const D=Math.min($.length,T);let q=0;for(;q<D-1;q++){const ne=L(String(q),$,w,S,_,R);O+=ne!==void 0?ne:"null",O+=P}const B=L(String(q),$,w,S,_,R);if(O+=B!==void 0?B:"null",$.length-1>T){const ne=$.length-T-1;O+=`${P}"... ${l(ne)} not stringified"`}return _!==""&&(O+=`
${I}`),w.pop(),`[${O}]`}let j=Object.keys($);const U=j.length;if(U===0)return"{}";if(A<w.length+1)return'"[Object]"';let M="",z="";_!==""&&(R+=_,P=`,
${R}`,M=" ");const F=Math.min(U,T);k&&!y($)&&(j=a(j)),w.push($);for(let D=0;D<F;D++){const q=j[D],B=L(q,$,w,S,_,R);B!==void 0&&(O+=`${z}${s(q)}:${M}${B}`,z=P)}if(U>T){const D=U-T;O+=`${z}"...":${M}"${l(D)} not stringified"`,z=P}return _!==""&&z.length>1&&(O=`
${R}${O}
${I}`),w.pop(),`{${O}}`}case"number":return isFinite($)?String($):p?p($):"null";case"boolean":return $===!0?"true":"false";case"undefined":return;case"bigint":if(x)return String($);default:return p?p($):void 0}}function J(N,f,w,S,_,R){switch(typeof f=="object"&&f!==null&&typeof f.toJSON=="function"&&(f=f.toJSON(N)),typeof f){case"string":return s(f);case"object":{if(f===null)return"null";if(w.indexOf(f)!==-1)return b;const $=R;let O="",P=",";if(Array.isArray(f)){if(f.length===0)return"[]";if(A<w.length+1)return'"[Array]"';w.push(f),_!==""&&(R+=_,O+=`
${R}`,P=`,
${R}`);const U=Math.min(f.length,T);let M=0;for(;M<U-1;M++){const F=J(String(M),f[M],w,S,_,R);O+=F!==void 0?F:"null",O+=P}const z=J(String(M),f[M],w,S,_,R);if(O+=z!==void 0?z:"null",f.length-1>T){const F=f.length-T-1;O+=`${P}"... ${l(F)} not stringified"`}return _!==""&&(O+=`
${$}`),w.pop(),`[${O}]`}w.push(f);let I="";_!==""&&(R+=_,P=`,
${R}`,I=" ");let j="";for(const U of S){const M=J(U,f[U],w,S,_,R);M!==void 0&&(O+=`${j}${s(U)}:${I}${M}`,j=P)}return _!==""&&j.length>1&&(O=`
${R}${O}
${$}`),w.pop(),`{${O}}`}case"number":return isFinite(f)?String(f):p?p(f):"null";case"boolean":return f===!0?"true":"false";case"undefined":return;case"bigint":if(x)return String(f);default:return p?p(f):void 0}}function G(N,f,w,S,_){switch(typeof f){case"string":return s(f);case"object":{if(f===null)return"null";if(typeof f.toJSON=="function"){if(f=f.toJSON(N),typeof f!="object")return G(N,f,w,S,_);if(f===null)return"null"}if(w.indexOf(f)!==-1)return b;const R=_;if(Array.isArray(f)){if(f.length===0)return"[]";if(A<w.length+1)return'"[Array]"';w.push(f),_+=S;let M=`
${_}`;const z=`,
${_}`,F=Math.min(f.length,T);let D=0;for(;D<F-1;D++){const B=G(String(D),f[D],w,S,_);M+=B!==void 0?B:"null",M+=z}const q=G(String(D),f[D],w,S,_);if(M+=q!==void 0?q:"null",f.length-1>T){const B=f.length-T-1;M+=`${z}"... ${l(B)} not stringified"`}return M+=`
${R}`,w.pop(),`[${M}]`}let $=Object.keys(f);const O=$.length;if(O===0)return"{}";if(A<w.length+1)return'"[Object]"';_+=S;const P=`,
${_}`;let I="",j="",U=Math.min(O,T);y(f)&&(I+=g(f,P,T),$=$.slice(f.length),U-=f.length,j=P),k&&($=a($)),w.push(f);for(let M=0;M<U;M++){const z=$[M],F=G(z,f[z],w,S,_);F!==void 0&&(I+=`${j}${s(z)}: ${F}`,j=P)}if(O>T){const M=O-T;I+=`${j}"...": "${l(M)} not stringified"`,j=P}return j!==""&&(I=`
${_}${I}
${R}`),w.pop(),`{${I}}`}case"number":return isFinite(f)?String(f):p?p(f):"null";case"boolean":return f===!0?"true":"false";case"undefined":return;case"bigint":if(x)return String(f);default:return p?p(f):void 0}}function X(N,f,w){switch(typeof f){case"string":return s(f);case"object":{if(f===null)return"null";if(typeof f.toJSON=="function"){if(f=f.toJSON(N),typeof f!="object")return X(N,f,w);if(f===null)return"null"}if(w.indexOf(f)!==-1)return b;let S="";if(Array.isArray(f)){if(f.length===0)return"[]";if(A<w.length+1)return'"[Array]"';w.push(f);const P=Math.min(f.length,T);let I=0;for(;I<P-1;I++){const U=X(String(I),f[I],w);S+=U!==void 0?U:"null",S+=","}const j=X(String(I),f[I],w);if(S+=j!==void 0?j:"null",f.length-1>T){const U=f.length-T-1;S+=`,"... ${l(U)} not stringified"`}return w.pop(),`[${S}]`}let _=Object.keys(f);const R=_.length;if(R===0)return"{}";if(A<w.length+1)return'"[Object]"';let $="",O=Math.min(R,T);y(f)&&(S+=g(f,",",T),_=_.slice(f.length),O-=f.length,$=","),k&&(_=a(_)),w.push(f);for(let P=0;P<O;P++){const I=_[P],j=X(I,f[I],w);j!==void 0&&(S+=`${$}${s(I)}:${j}`,$=",")}if(R>T){const P=R-T;S+=`${$}"...":"${l(P)} not stringified"`}return w.pop(),`{${S}}`}case"number":return isFinite(f)?String(f):p?p(f):"null";case"boolean":return f===!0?"true":"false";case"undefined":return;case"bigint":if(x)return String(f);default:return p?p(f):void 0}}function W(N,f,w){if(arguments.length>1){let S="";if(typeof w=="number"?S=" ".repeat(Math.min(w,10)):typeof w=="string"&&(S=w.slice(0,10)),f!=null){if(typeof f=="function")return L("",{"":N},[],f,S,"");if(Array.isArray(f))return J("",N,[],m(f),S,"")}if(S.length!==0)return G("",N,[],S,"")}return X("",N,[])}return W}})(le,le.exports);var Fe=le.exports;function $t(r,e){const t=[];let n=0;for(let i=0;i<r.length;i++)for(let s=n;s<e.length;s++)r[i]===e[s]&&(t.push(s),n=s+1);return t}function _t(r,e){const t=[];let n=0;for(let i=0;i<r.length;i++)for(let s=n;s<e.length;s++)r[i]!==e[s]&&(t.push(e[s]),n=s+1);return t}function At(r,e){let t=0,n=r.length-1;for(;t<=n;){const i=(t+n)/2|0;if(r[i]===e)return i;r[i]<e?t=i+1:n=i-1}return-1}function Ve(r){return r*Math.random()|0}function Tt(r,e){return r=Math.floor(r),e=Math.floor(e),r+Ve(1+e-r)}function Rt(r,e){if(r.length<1||e<1)return[];const t=Math.min(r.length,e),n=Tt(1,t),i=new Set;for(let a=0;a<n;a++)i.add(Ve(r.length));const s=[];for(const a of i)s.push(r[a]);return s}function xt(r,e){if(r==="*"||r.length===e.length&&r===e)return!0;let t=0,n=0;for(;t<r.length&&n<e.length;){if(r[t]===e[n]){t++,n++;continue}if(r[t]==="*"){if(r[t+1]===e[n]){t++;continue}n++;continue}return!1}return t>=r.length-1}function Ot(){const r=()=>{};return{fatal:r,error:r,warn:r,info:r,debug:r,trace:r}}const Mt=typeof window>"u";var oe={findNotMatching:_t,findMatchingIndexes:$t,bsearchIndex:At,wildcardMatch:xt,randomSubset:Rt,abstractLogging:Ot,isServerSide:Mt};let kt=class{constructor(e){this.options=e}async get(e){throw new Error("storage get method not implemented")}async set(e,t,n,i){throw new Error("storage set method not implemented")}async remove(e){throw new Error("storage remove method not implemented")}async invalidate(e){throw new Error("storage invalidate method not implemented")}async clear(e){throw new Error("storage clear method not implemented")}async refresh(){throw new Error("storage refresh method not implemented")}};var Je=kt,ue,_e;function Pt(){if(_e)return ue;_e=1;const r=Fe,e=Je,{findNotMatching:t,randomSubset:n,abstractLogging:i}=oe,s=64,a=64,c=60;class y extends e{constructor(o={}){if(!o.client||typeof o.client!="object")throw new Error("Redis client is required");if(super(o),o.invalidation&&o.invalidation.referencesTTL&&(typeof o.invalidation.referencesTTL!="number"||o.invalidation.referencesTTL<1))throw new Error("invalidation.referencesTTL must be a positive integer greater than 1");this.log=o.log||i(),this.store=o.client,this.invalidation=!!o.invalidation,this.referencesTTL=o.invalidation&&o.invalidation.referencesTTL||c}getReferenceKeyLabel(o){return`r:${o}`}getKeyReferenceLabel(o){return`k:${o}`}async get(o){this.log.debug({msg:"acd/storage/redis.get",key:o});try{const u=await this.store.get(o);if(!u){if(!this.invalidation)return;this.clearReferences(o);return}return JSON.parse(u)}catch(u){this.log.error({msg:"acd/storage/redis.get error",err:u,key:o})}}async getTTL(o){this.log.debug({msg:"acd/storage/memory.getTTL",key:o});let u=await this.store.pttl(o);return u<0?0:(u=Math.ceil(u/1e3),u)}async set(o,u,h,l){if(this.log.debug({msg:"acd/storage/redis.set key",key:o,value:u,ttl:h,references:l}),h=Number(h),!(!h||h<0))try{if(await this.store.set(o,r(u),"EX",h),!l||l.length<1)return;if(!this.invalidation){this.log.warn({msg:"acd/storage/redis.set, invalidation is disabled, references are useless",key:o,references:l});return}const m=[],v=await this.store.smembers(this.getKeyReferenceLabel(o));if(this.log.debug({msg:"acd/storage/redis.set current references",key:o,currentReferences:v}),v.length>1){v.sort(),l.sort();const p=t(l,v);for(const b of p)m.push(["srem",this.getReferenceKeyLabel(b),o]);m.push(["del",this.getKeyReferenceLabel(o)])}const E=v.length>1?t(v,l):l;this.log.debug({msg:"acd/storage/redis.set references to add",key:o,referencesToAdd:E});for(let p=0;p<E.length;p++){const b=E[p],x=this.getReferenceKeyLabel(b);m.push(["sadd",x,o]),m.push(["expire",x,this.referencesTTL])}const d=this.getKeyReferenceLabel(o);m.push(["sadd",d,l]),m.push(["expire",d,h]),this.log.debug({msg:"acd/storage/redis.set references writes",writes:m}),await this.store.pipeline(m).exec()}catch(m){this.log.error({msg:"acd/storage/redis.set error",err:m,key:o,ttl:h,references:l})}}async remove(o){this.log.debug({msg:"acd/storage/redis.remove",key:o});try{const u=await this.store.del(o)>0;return u&&this.invalidation&&await this.clearReferences(o),u}catch(u){this.log.error({msg:"acd/storage/redis.remove error",err:u,key:o})}}async invalidate(o){if(!this.invalidation)return this.log.warn({msg:"acd/storage/redis.invalidate, exit due invalidation is disabled"}),[];this.log.debug({msg:"acd/storage/redis.invalidate",references:o});try{return Array.isArray(o)?await this._invalidateReferences(o):await this._invalidateReference(o)}catch(u){return this.log.error({msg:"acd/storage/redis.invalidate error",err:u,references:o}),[]}}async _invalidateReferences(o,u=!0){const h=o.map(E=>["smembers",u?this.getReferenceKeyLabel(E):E]),l=await this.store.pipeline(h).exec();this.log.debug({msg:"acd/storage/redis._invalidateReferences keys",keys:l});const m=[],v=[];for(let E=0;E<l.length;E++){const d=l[E][1];if(d){this.log.debug({msg:"acd/storage/redis._invalidateReferences got keys to be invalidated",keys:d});for(let p=0;p<d.length;p++){const b=d[p];this.log.debug({msg:"acd/storage/redis._invalidateReferences del key"+b}),v.push(b),m.push(["del",b])}}}return await this.store.pipeline(m).exec(),await this.clearReferences(v),v}async _invalidateReference(o){let u;if(o.includes("*")){const m=await this.store.keys(this.getReferenceKeyLabel(o));return this._invalidateReferences(m,!1)}else u=await this.store.smembers(this.getReferenceKeyLabel(o));this.log.debug({msg:"acd/storage/redis._invalidateReference keys",keys:u});const h=[],l=[];for(let m=0;m<u.length;m++){const v=u[m];this.log.debug({msg:"acd/storage/redis._invalidateReference del key"+v}),l.push(v),h.push(["del",v])}return await this.store.pipeline(h).exec(),await this.clearReferences(l),l}async clear(o){this.log.debug({msg:"acd/storage/redis.clear",name:o});try{if(!o){await this.store.flushall();return}const u=await this.store.keys(`${o}*`);this.log.debug({msg:"acd/storage/redis.clear keys",keys:u});const h=u.map(l=>["del",l]);if(await this.store.pipeline(h).exec(),!this.invalidation)return;await this.clearReferences(u)}catch(u){this.log.error({msg:"acd/storage/redis.clear error",err:u,name:o})}}async refresh(){try{await this.store.flushall()}catch(o){this.log.error({msg:"acd/storage/redis.refresh error",err:o})}}async clearReferences(o){try{if(!o){this.log.warn({msg:"acd/storage/redis.clearReferences invalid call due to empty key"});return}Array.isArray(o)||(o=[o]);const u=o.map(m=>["smembers",this.getKeyReferenceLabel(m)]),h=await this.store.pipeline(u).exec();this.log.debug({msg:"acd/storage/redis.clearReferences references",keys:o,referencesKeys:h});const l={};for(let m=0;m<o.length;m++){for(let E=0;E<h[m][1].length;E++){const d=this.getReferenceKeyLabel(h[m][1][E]);l[d]||(l[d]=["srem",d,o])}const v=this.getKeyReferenceLabel(o[m]);l[v]=["del",v]}this.log.debug({msg:"acd/storage/redis.clearReferences writes pipeline",writes:l}),await this.store.pipeline(Object.values(l)).exec()}catch(u){this.log.error({msg:"acd/storage/redis.clearReferences error",err:u})}}async gc(o="lazy",u={}){if(this.log.debug({msg:"acd/storage/redis.gc",mode:o,options:u}),!this.invalidation){this.log.warn({msg:"acd/storage/redis.gc does not run due to invalidation is disabled"});return}o!=="strict"&&o!=="lazy"&&(o="lazy");const h={references:{scanned:[],removed:[]},keys:{scanned:new Set,removed:new Set},loops:0,cursor:0,error:null};try{let l=0,m=a;if(u.chunk&&(typeof u.chunk!="number"||u.chunk<1))return h.error=new Error("chunk must be a positive integer greater than 1"),h;if(u.lazy){if(u.lazy.chunk){if(typeof u.lazy.chunk!="number"||u.lazy.chunk<1)return h.error=new Error("lazy.chunk must be a positive integer greater than 1"),h;m=u.lazy.chunk}if(u.lazy.cursor){if(typeof u.lazy.cursor!="number"||u.lazy.cursor<0)return h.error=new Error("lazy.cursor must be a positive integer greater than 0"),h;l=u.lazy.cursor}}const v=u.chunk||s,E=Math.min(m,v),d=l;let p=-1,b=-1;do{h.loops++;const x=await this.store.scan(l,"match","r:*","count",E);l=Number(x[0]),p=x[1].length;const k=o==="lazy"?n(x[1],m):x[1];h.references.scanned=h.references.scanned.concat(k);let A=[];for(let w=0;w<k.length;w++){const S=k[w];A.push(["smembers",S])}const T=await this.store.pipeline(A).exec(),L={},J={};for(let w=0;w<T.length;w++){const S=T[w],_=k[w];J[_]=S[1];for(let R=0;R<S[1].length;R++){const $=S[1][R];L[$]?L[$].push(_):L[$]=[_],h.keys.scanned.add($)}}const G=Object.keys(L);A=G.map(w=>["exists",w]);const X=await this.store.pipeline(A).exec(),W={};for(let w=0;w<G.length;w++){const S=G[w];if(X[w][1]!==1)for(let _=0;_<L[S].length;_++){const R=L[S][_];W[R]?W[R].push(S):W[R]=[S],h.keys.removed.add(S)}}const N=Object.keys(W),f=[];for(let w=0;w<N.length;w++){const S=N[w];J[S].length===W[S].length?(f.push(["del",S]),h.references.removed.push(S)):f.push(["srem",S,W[S]])}if(await this.store.pipeline(f).exec(),b=f.length,o==="lazy"&&h.references.scanned.length>=m)break}while(d!==l&&p>0&&b>0);h.cursor=l,h.keys.scanned=Array.from(h.keys.scanned),h.keys.removed=Array.from(h.keys.removed)}catch(l){this.log.error({msg:"acd/storage/redis.gc error",err:l}),h.error=l}return h}}return ue=y,ue}function H(r){if(typeof r!="function")throw new Error("obliterator/iterator: expecting a function!");this.next=r}typeof Symbol<"u"&&(H.prototype[Symbol.iterator]=function(){return this});H.of=function(){var r=arguments,e=r.length,t=0;return new H(function(){return t>=e?{done:!0}:{done:!1,value:r[t++]}})};H.empty=function(){var r=new H(function(){return{done:!0}});return r};H.fromSequence=function(r){var e=0,t=r.length;return new H(function(){return e>=t?{done:!0}:{done:!1,value:r[e++]}})};H.is=function(r){return r instanceof H?!0:typeof r=="object"&&r!==null&&typeof r.next=="function"};var It=H,ge={};ge.ARRAY_BUFFER_SUPPORT=typeof ArrayBuffer<"u";ge.SYMBOL_SUPPORT=typeof Symbol<"u";var qe=ge,jt=qe.ARRAY_BUFFER_SUPPORT,Kt=qe.SYMBOL_SUPPORT,Be=function(e,t){var n,i,s,a,c;if(!e)throw new Error("obliterator/forEach: invalid iterable.");if(typeof t!="function")throw new Error("obliterator/forEach: expecting a callback.");if(Array.isArray(e)||jt&&ArrayBuffer.isView(e)||typeof e=="string"||e.toString()==="[object Arguments]"){for(s=0,a=e.length;s<a;s++)t(e[s],s);return}if(typeof e.forEach=="function"){e.forEach(t);return}if(Kt&&Symbol.iterator in e&&typeof e.next!="function"&&(e=e[Symbol.iterator]()),typeof e.next=="function"){for(n=e,s=0;c=n.next(),c.done!==!0;)t(c.value,s),s++;return}for(i in e)e.hasOwnProperty(i)&&t(e[i],i)},ye={};(function(r){var e=Math.pow(2,8)-1,t=Math.pow(2,16)-1,n=Math.pow(2,32)-1,i=Math.pow(2,7)-1,s=Math.pow(2,15)-1,a=Math.pow(2,31)-1;r.getPointerArray=function(y){var g=y-1;if(g<=e)return Uint8Array;if(g<=t)return Uint16Array;if(g<=n)return Uint32Array;throw new Error("mnemonist: Pointer Array of size > 4294967295 is not supported.")},r.getSignedPointerArray=function(y){var g=y-1;return g<=i?Int8Array:g<=s?Int16Array:g<=a?Int32Array:Float64Array},r.getNumberType=function(y){return y===(y|0)?Math.sign(y)===-1?y<=127&&y>=-128?Int8Array:y<=32767&&y>=-32768?Int16Array:Int32Array:y<=255?Uint8Array:y<=65535?Uint16Array:Uint32Array:Float64Array};var c={Uint8Array:1,Int8Array:2,Uint16Array:3,Int16Array:4,Uint32Array:5,Int32Array:6,Float32Array:7,Float64Array:8};r.getMinimalRepresentation=function(y,g){var o=null,u=0,h,l,m,v,E;for(v=0,E=y.length;v<E;v++)m=g?g(y[v]):y[v],l=r.getNumberType(m),h=c[l.name],h>u&&(u=h,o=l);return o},r.isTypedArray=function(y){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView(y)},r.concat=function(){var y=0,g,o,u;for(g=0,u=arguments.length;g<u;g++)y+=arguments[g].length;var h=new arguments[0].constructor(y);for(g=0,o=0;g<u;g++)h.set(arguments[g],o),o+=arguments[g].length;return h},r.indices=function(y){for(var g=r.getPointerArray(y),o=new g(y),u=0;u<y;u++)o[u]=u;return o}})(ye);var re={},He=Be,Ge=ye;function Lt(r){return Array.isArray(r)||Ge.isTypedArray(r)}function pe(r){if(typeof r.length=="number")return r.length;if(typeof r.size=="number")return r.size}function Nt(r){var e=pe(r),t=typeof e=="number"?new Array(e):[],n=0;return He(r,function(i){t[n++]=i}),t}function Ut(r){var e=pe(r),t=typeof e=="number"?Ge.getPointerArray(e):Array,n=typeof e=="number"?new Array(e):[],i=typeof e=="number"?new t(e):[],s=0;return He(r,function(a){n[s]=a,i[s]=s++}),[n,i]}re.isArrayLike=Lt;re.guessLength=pe;re.toArray=Nt;re.toArrayWithIndices=Ut;var me=It,Ct=Be,zt=ye,Dt=re;function K(r,e,t){if(arguments.length<2&&(t=r,r=null,e=null),this.capacity=t,typeof this.capacity!="number"||this.capacity<=0)throw new Error("mnemonist/lru-cache: capacity should be positive number.");if(!isFinite(this.capacity)||Math.floor(this.capacity)!==this.capacity)throw new Error("mnemonist/lru-cache: capacity should be a finite positive integer.");var n=zt.getPointerArray(t);this.forward=new n(t),this.backward=new n(t),this.K=typeof r=="function"?new r(t):new Array(t),this.V=typeof e=="function"?new e(t):new Array(t),this.size=0,this.head=0,this.tail=0,this.items={}}K.prototype.clear=function(){this.size=0,this.head=0,this.tail=0,this.items={}};K.prototype.splayOnTop=function(r){var e=this.head;if(this.head===r)return this;var t=this.backward[r],n=this.forward[r];return this.tail===r?this.tail=t:this.backward[n]=t,this.forward[t]=n,this.backward[e]=r,this.head=r,this.forward[r]=e,this};K.prototype.set=function(r,e){var t=this.items[r];if(typeof t<"u"){this.splayOnTop(t),this.V[t]=e;return}this.size<this.capacity?t=this.size++:(t=this.tail,this.tail=this.backward[t],delete this.items[this.K[t]]),this.items[r]=t,this.K[t]=r,this.V[t]=e,this.forward[t]=this.head,this.backward[this.head]=t,this.head=t};K.prototype.setpop=function(r,e){var t=null,n=null,i=this.items[r];return typeof i<"u"?(this.splayOnTop(i),t=this.V[i],this.V[i]=e,{evicted:!1,key:r,value:t}):(this.size<this.capacity?i=this.size++:(i=this.tail,this.tail=this.backward[i],t=this.V[i],n=this.K[i],delete this.items[n]),this.items[r]=i,this.K[i]=r,this.V[i]=e,this.forward[i]=this.head,this.backward[this.head]=i,this.head=i,n?{evicted:!0,key:n,value:t}:null)};K.prototype.has=function(r){return r in this.items};K.prototype.get=function(r){var e=this.items[r];if(!(typeof e>"u"))return this.splayOnTop(e),this.V[e]};K.prototype.peek=function(r){var e=this.items[r];if(!(typeof e>"u"))return this.V[e]};K.prototype.forEach=function(r,e){e=arguments.length>1?e:this;for(var t=0,n=this.size,i=this.head,s=this.K,a=this.V,c=this.forward;t<n;)r.call(e,a[i],s[i],this),i=c[i],t++};K.prototype.keys=function(){var r=0,e=this.size,t=this.head,n=this.K,i=this.forward;return new me(function(){if(r>=e)return{done:!0};var s=n[t];return r++,r<e&&(t=i[t]),{done:!1,value:s}})};K.prototype.values=function(){var r=0,e=this.size,t=this.head,n=this.V,i=this.forward;return new me(function(){if(r>=e)return{done:!0};var s=n[t];return r++,r<e&&(t=i[t]),{done:!1,value:s}})};K.prototype.entries=function(){var r=0,e=this.size,t=this.head,n=this.K,i=this.V,s=this.forward;return new me(function(){if(r>=e)return{done:!0};var a=n[t],c=i[t];return r++,r<e&&(t=s[t]),{done:!1,value:[a,c]}})};typeof Symbol<"u"&&(K.prototype[Symbol.iterator]=K.prototype.entries);K.prototype.inspect=function(){for(var r=new Map,e=this.entries(),t;t=e.next(),!t.done;)r.set(t.value[0],t.value[1]);return Object.defineProperty(r,"constructor",{value:K,enumerable:!1}),r};typeof Symbol<"u"&&(K.prototype[Symbol.for("nodejs.util.inspect.custom")]=K.prototype.inspect);K.from=function(r,e,t,n){if(arguments.length<2){if(n=Dt.guessLength(r),typeof n!="number")throw new Error("mnemonist/lru-cache.from: could not guess iterable length. Please provide desired capacity as last argument.")}else arguments.length===2&&(n=e,e=null,t=null);var i=new K(e,t,n);return Ct(r,function(s,a){i.set(a,s)}),i};var Ft=K;const Vt=Ft,{abstractLogging:Jt}=oe,qt=Je,{findMatchingIndexes:Bt,findNotMatching:Ae,bsearchIndex:Ht,wildcardMatch:Gt}=oe,Yt=typeof globalThis.setImmediate<"u"?globalThis.setImmediate:(r,...e)=>setTimeout(r,0,...e),Wt=1024;let Xt=class extends qt{constructor(e={}){if(e.size&&(typeof e.size!="number"||e.size<1))throw new Error("size must be a positive integer greater than 0");super(e),this.size=e.size||Wt,this.log=e.log||Jt(),this.invalidation=e.invalidation||!1,this.init()}init(){this.store=new Vt(this.size),this.invalidation&&(this.keysReferences=new Map,this.referencesKeys=new Map)}get(e){this.log.debug({msg:"acd/storage/memory.get",key:e});const t=this.store.get(e);if(t){if(this.log.debug({msg:"acd/storage/memory.get, entry",entry:t,now:ie()}),t.start+t.ttl>ie())return this.log.debug({msg:"acd/storage/memory.get, key is NOT expired",key:e,entry:t}),t.value;this.log.debug({msg:"acd/storage/memory.get, key is EXPIRED",key:e,entry:t}),Yt(()=>this.remove(e))}}getTTL(e){this.log.debug({msg:"acd/storage/memory.getTTL",key:e});const t=this.store.peek(e);let n=0;return t&&(n=t.start+t.ttl-ie(),n<0&&(n=0)),n}set(e,t,n,i){if(this.log.debug({msg:"acd/storage/memory.set",key:e,value:t,ttl:n,references:i}),n=Number(n),!n||n<0)return;const s=this.store.has(e),a=this.store.setpop(e,{value:t,ttl:n,start:ie()});if(this.log.debug({msg:"acd/storage/memory.set, evicted",removed:a}),a&&a.evicted&&(this.log.debug({msg:"acd/storage/memory.set, remove evicted key",key:a.key}),this._removeReferences([a.key])),!i||i.length<1)return;if(!this.invalidation){this.log.warn({msg:"acd/storage/memory.set, invalidation is disabled, references are useless"});return}i=[...new Set(i)];let c;if(s&&(c=this.keysReferences.get(e),this.log.debug({msg:"acd/storage/memory.set, current keys-references",key:e,references:c}),c)){c.sort(),i.sort();const g=Ae(i,c);for(const o of g){const u=this.referencesKeys.get(o);if(!u)continue;const h=Ht(u,e);if(!(h<0)){if(u.splice(h,1),u.length<1){this.referencesKeys.delete(o);continue}this.referencesKeys.set(o,u)}}}const y=c?Ae(c,i):i;for(let g=0;g<y.length;g++){const o=y[g];let u=this.referencesKeys.get(o);u?(this.log.debug({msg:"acd/storage/memory.set, add reference-key",key:e,reference:o}),u.push(e)):u=[e],this.log.debug({msg:"acd/storage/memory.set, set reference-keys",keys:u,reference:o}),this.referencesKeys.set(o,u)}this.keysReferences.set(e,i)}remove(e){this.log.debug({msg:"acd/storage/memory.remove",key:e});const t=this._removeKey(e);return this._removeReferences([e]),t}_removeKey(e){return this.log.debug({msg:"acd/storage/memory._removeKey",key:e}),this.store.has(e)?(this.store.set(e,void 0),!0):!1}_removeReferences(e){if(!this.invalidation)return;this.log.debug({msg:"acd/storage/memory._removeReferences",keys:e});const t=new Set;for(let n=0;n<e.length;n++){const i=e[n],s=this.keysReferences.get(i);if(s){for(let a=0;a<s.length;a++)t.add(s[a]);this.log.debug({msg:"acd/storage/memory._removeReferences, delete key-references",key:i}),this.keysReferences.delete(i)}}this._removeReferencesKeys([...t],e)}_removeReferencesKeys(e,t){t.sort(),this.log.debug({msg:"acd/storage/memory._removeReferencesKeys",references:e,keys:t});for(let n=0;n<e.length;n++){const i=e[n],s=this.referencesKeys.get(i);if(this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, get reference-key",reference:i,keys:t,referencesKeys:s}),!s)continue;const a=Bt(t,s);if(this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, removing",reference:i,referencesToRemove:a,referencesKeys:s}),a.length===s.length){this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, delete",reference:i}),this.referencesKeys.delete(i);continue}for(let c=a.length-1;c>=0;c--)this.log.debug({msg:"acd/storage/memory._removeReferencesKeys, remove",reference:i,referencesKeys:s,at:a[c]}),s.splice(a[c],1)}}invalidate(e){return this.invalidation?(this.log.debug({msg:"acd/storage/memory.invalidate",references:e}),Array.isArray(e)?this._invalidateReferences(e):this._invalidateReference(e)):(this.log.warn({msg:"acd/storage/memory.invalidate, exit due invalidation is disabled"}),[])}_invalidateReferences(e){const t=[];for(let n=0;n<e.length;n++){const i=e[n],s=this.referencesKeys.get(i);if(this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove keys on reference",reference:i,keys:s}),!!s){for(let a=0;a<s.length;a++){const c=s[a];this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove key on reference",reference:i,key:c}),this._removeKey(c)&&t.push(c)}this.log.debug({msg:"acd/storage/memory._invalidateReferences, remove references of",reference:i,keys:s}),this._removeReferences([...s])}}return t}_invalidateReference(e){if(e.includes("*")){const i=[];for(const s of this.referencesKeys.keys())Gt(e,s)&&i.push(s);return this._invalidateReferences(i)}const t=this.referencesKeys.get(e),n=[];if(this.log.debug({msg:"acd/storage/memory._invalidateReference, remove keys on reference",reference:e,keys:t}),!t)return n;for(let i=0;i<t.length;i++){const s=t[i];this.log.debug({msg:"acd/storage/memory._invalidateReference, remove key on reference",reference:e,key:s}),this._removeKey(s)&&n.push(s)}return this.log.debug({msg:"acd/storage/memory._invalidateReference, remove references of",reference:e,keys:t}),this._removeReferences([...t]),n}clear(e){if(this.log.debug({msg:"acd/storage/memory.clear",name:e}),!e){if(this.store.clear(),!this.invalidation)return;this.referencesKeys.clear(),this.keysReferences.clear();return}const t=[];this.store.forEach((i,s)=>{this.log.debug({msg:"acd/storage/memory.clear, iterate key",key:s}),s.indexOf(e)===0&&(this.log.debug({msg:"acd/storage/memory.clear, remove key",key:s}),t.push(s))});const n=[];for(let i=0;i<t.length;i++)this._removeKey(t[i])&&n.push(t[i]);return this._removeReferences(n),n}refresh(){this.log.debug({msg:"acd/storage/memory.refresh"}),this.init()}},te;function ie(){if(te!==void 0)return te;te=Math.floor(Date.now()/1e3);const r=setTimeout(Qt,1e3);return typeof r.unref=="function"&&r.unref(),te}function Qt(){te=void 0}var Zt=Xt;const{isServerSide:Ye}=oe;let We;Ye&&(We=Pt());const er=Zt,Te={redis:"redis",memory:"memory"};function tr(r,e){if(!Ye&&r===Te.redis)throw new Error("Redis storage is not supported in the browser");return r===Te.redis?new We(e):new er(e)}var Xe=tr;const{kValues:V,kStorage:Re,kStorages:Z,kTransfromer:xe,kTTL:Oe,kOnDedupe:Me,kOnError:ke,kOnHit:Pe,kOnMiss:Ie,kStale:je}=Et,rr=Fe,nr=Xe;let ir=class{constructor(e={}){if(!e.storage)throw new Error("storage is required");if(e.ttl&&typeof e.ttl=="number"&&(e.ttl<0||!Number.isInteger(e.ttl)))throw new Error("ttl must be a positive integer greater than 0");if(e.onDedupe&&typeof e.onDedupe!="function")throw new Error("onDedupe must be a function");if(e.onError&&typeof e.onError!="function")throw new Error("onError must be a function");if(e.onHit&&typeof e.onHit!="function")throw new Error("onHit must be a function");if(e.onMiss&&typeof e.onMiss!="function")throw new Error("onMiss must be a function");if(typeof e.stale=="number"&&!(Math.floor(e.stale)===e.stale&&e.stale>=0))throw new Error("stale must be an integer greater or equal to 0");this[V]={},this[Re]=e.storage,this[Z]=new Map,this[Z].set("_default",e.storage),this[xe]=e.transformer,this[Oe]=e.ttl||0,this[Me]=e.onDedupe||Q,this[ke]=e.onError||Q,this[Pe]=e.onHit||Q,this[Ie]=e.onMiss||Q,this[je]=e.stale||0}define(e,t,n){if(typeof t=="function"&&(n=t,t={}),e&&this[e])throw new Error(`${e} is already defined in the cache or it is a forbidden name`);if(t=t||{},typeof n!="function")throw new TypeError(`Missing the function parameter for '${e}'`);const i=t.serialize;if(i&&typeof i!="function")throw new TypeError("serialize must be a function");const s=t.references;if(s&&typeof s!="function")throw new TypeError("references must be a function");if(typeof t.ttl!="function"&&t.ttl&&(typeof t.ttl!="number"||t.ttl<0||!Number.isInteger(t.ttl)))throw new Error("ttl must be a positive integer greater than 0");let a;t.storage?(a=nr(t.storage.type,t.storage.options),this[Z].set(e,a)):a=this[Re];const c=t.ttl!==void 0?t.ttl:this[Oe],y=t.stale!==void 0?t.stale:this[je],g=t.onDedupe||this[Me],o=t.onError||this[ke],u=t.onHit||this[Pe],h=t.onMiss||this[Ie],l=t.transformer||this[xe],m=new sr(n,e,i,s,a,l,c,g,o,u,h,y);return this[V][e]=m,this[e]=m.add.bind(m),this}async clear(e,t){if(e){if(!this[V][e])throw new Error(`${e} is not defined in the cache`);await this[V][e].clear(t);return}const n=[];for(const i of Object.values(this[V]))n.push(i.clear());await Promise.all(n)}async get(e,t){if(!this[V][e])throw new Error(`${e} is not defined in the cache`);return this[V][e].get(t)}async set(e,t,n,i,s){if(!this[V][e])throw new Error(`${e} is not defined in the cache`);return this[V][e].set(t,n,i,s)}async invalidate(e,t){if(!this[V][e])throw new Error(`${e} is not defined in the cache`);return this[V][e].invalidate(t)}async invalidateAll(e,t="_default"){if(!this[Z].has(t))throw new Error(`${t} storage is not defined in the cache`);await this[Z].get(t).invalidate(e)}};class sr{constructor(e,t,n,i,s,a,c,y,g,o,u,h){this.dedupes=new Map,this.func=e,this.name=t,this.serialize=n,this.references=i,this.storage=s,this.transformer=a,this.ttl=c,this.onDedupe=y,this.onError=g,this.onHit=o,this.onMiss=u,this.stale=h}getKey(e){const t=this.serialize?this.serialize(e):e;return typeof t=="string"?t:rr(t)}getStorageKey(e){return`${this.name}~${e}`}getStorageName(){return`${this.name}~`}add(e){try{const t=this.getKey(e);let n=this.dedupes.get(t);return n?this.onDedupe(t):(n=new or,this.buildPromise(n,e,t),this.dedupes.set(t,n)),n.promise}catch(t){this.onError(t)}}async wrapFunction(e,t){const n=this.getStorageKey(t);if(this.ttl>0||typeof this.ttl=="function"){const i=await this.get(n);if(i!==void 0){this.onHit(t);const s=typeof this.stale=="function"?this.stale(i):this.stale;return s>0&&await this.storage.getTTL(n)<=s&&this._wrapFunction(n,e,t).catch(Q),i}else this.onMiss(t)}return this._wrapFunction(n,e,t)}async _wrapFunction(e,t,n){const i=await this.func(t,n),s=typeof this.stale=="function"?this.stale(i):this.stale;let a=typeof this.ttl=="function"?this.ttl(i):this.ttl;if(a==null||typeof a!="number"||!Number.isInteger(a))return this.onError(new Error("ttl must be an integer")),i;if(a+=s,a<1)return i;if(!this.references)return await this.set(e,i,a),i;try{let c=this.references(t,n,i),y=i;c&&typeof c.then=="function"&&(c=await c),this.transformer&&(y=this.transformer.serialize(i)),await this.storage.set(e,y,a,c)}catch(c){this.onError(c)}return i}buildPromise(e,t,n){e.promise=this.wrapFunction(t,n),e.promise.then(i=>(this.dedupes.delete(n),i)).catch(i=>{this.onError(i),this.dedupes.delete(n);const s=this.storage.remove(this.getStorageKey(n));s&&typeof s.catch=="function"&&s.catch(Q)})}async clear(e){if(e){const t=this.getKey(e);this.dedupes.delete(t),await this.storage.remove(this.getStorageKey(t));return}await this.storage.clear(this.getStorageName()),this.dedupes.clear()}async get(e){const t=await this.storage.get(e);return this.transformer&&t?await this.transformer.deserialize(t):t}async set(e,t,n,i){return this.transformer&&(t=this.transformer.serialize(t)),this.storage.set(e,t,n,i)}async invalidate(e){return this.storage.invalidate(e)}}class or{constructor(){this.promise=null}}function Q(){}De.Cache=ir;const{Cache:Qe}=De,Ze=Xe;function ar(r){r?r.storage||(r.storage={type:"memory"}):r={storage:{type:"memory"}};const e=Ze(r.storage.type,r.storage.options);return new Qe({...r,storage:e})}var ur={Cache:Qe,createCache:ar,createStorage:Ze};let ce=0,Ke=[],C=[],Le=(r,e)=>{let t=[],n={get:()=>(n.lc||n.listen(()=>{})(),n.value),l:e||0,lc:0,listen:(i,s)=>(n.lc=t.push(i,s||n.l)/2,()=>{let a=t.indexOf(i);~a&&(t.splice(a,2),--n.lc||n.off())}),notify(i,s){let a=!C.length;for(let c=0;c<t.length;c+=2)C.push(t[c],t[c+1],n.value,i,s);if(a){for(let c=0;c<C.length;c+=5){let y;for(let g=c+1;!y&&(g+=5)<C.length;)C[g]<C[c+1]&&(y=C.push(C[c],C[c+1],C[c+2],C[c+3],C[c+4]));y||C[c](C[c+2],C[c+3],C[c+4])}C.length=0}},off(){},set(i){let s=n.value;s!==i&&(n.value=i,n.notify(s))},subscribe(i,s){let a=n.listen(i,s);return i(n.value),a},value:r};return n};const fe=typeof document>"u"?"server":"browser";function Ne(r){return r.withConfig({allowReconfigure:!1})}const cr=r=>{const{ssr:e=!1,tag:t="core-loader"}=r;if(e&&r.client)throw new TypeError("`client` option is not allowed when `ssr: true`, use `setServerClient` from your server entry point instead");if(!e&&r.client===!1)throw new TypeError("You must set `ssr: true` when `client: false` is used");if(!e&&!r.client)throw new TypeError("`client` is required");let n=e?void 0:Ne(r.client);function i(o){return ur.createCache().define("fetch",async u=>{if(!o)throw new Error("You have to set the Sanity client with `setServerClient` before any data fetching is done");const{query:h,params:l={},perspective:m,useCdn:v}=JSON.parse(u),{result:E,resultSourceMap:d}=await o.fetch(h,l,{tag:t,filterResponse:!1,perspective:m,useCdn:v});return{result:E,resultSourceMap:d}})}function s(){const o=(n==null?void 0:n.config().perspective)||"published";return a.instance=i(n),{hydrate:(u,h,l)=>({loading:(l==null?void 0:l.data)===void 0||(l==null?void 0:l.sourceMap)===void 0,error:void 0,data:l==null?void 0:l.data,sourceMap:l==null?void 0:l.sourceMap,perspective:o}),fetch:(u,h,l,m)=>{if(m.signal.aborted)return;const v=(ce+=1,()=>{if(ce-=1,ce===0){let E=Ke;Ke=[];for(let d of E)d()}});l.setKey("loading",!0),l.setKey("error",void 0),a.instance.fetch(JSON.stringify({query:u,params:h})).then(E=>{m.signal.aborted||(l.setKey("data",E.result),l.setKey("sourceMap",E.resultSourceMap),l.setKey("perspective",o))}).catch(E=>{l.setKey("error",E)}).finally(()=>{l.setKey("loading",!1),v()})}}}const a={instance:i(n)},c=Le(n?s():void 0),y=(o=>{const{ssr:u,setFetcher:h}=o;return l=>{if(fe==="server")throw new Error("Live mode is not supported in server environments");if(u&&!l.client)throw new Error("The `client` option in `enableLiveMode` is required");const m=l.client||o.client||void 0,v=new AbortController;let E;return ft(()=>import("./enableLiveMode-Cs5eyLSQ.js"),__vite__mapDeps([0,1,2,3,4])).then(({enableLiveMode:d})=>{v.signal.aborted||(E=d({...l,client:m,setFetcher:h,ssr:u}))}),()=>{v.abort(),E==null||E()}}})({client:n||void 0,ssr:e,setFetcher:o=>{const u=c.get();return c.set(o),()=>c.set(u)}}),g={instance:void 0,canPreviewDrafts:!1};return{createFetcherStore:(o,u={},h)=>{const l=c.get(),m=((k={})=>{let A=Le(k);return A.setKey=function(T,L){let J=A.value;typeof L>"u"&&T in A.value?(A.value={...A.value},delete A.value[T],A.notify(J,T)):A.value[T]!==L&&(A.value={...A.value,[T]:L},A.notify(J,T))},A})(l?l.hydrate(o,u,h):{loading:!1,error:typeof(h==null?void 0:h.data)>"u"?new Error("The `initial` option is required when `ssr: true`"):void 0,data:h==null?void 0:h.data,sourceMap:h==null?void 0:h.sourceMap,perspective:h==null?void 0:h.perspective});return E=()=>{let k=new AbortController;const A=c.subscribe(T=>{!T||k.signal.aborted||(k.abort(),k=new AbortController,T.fetch(o,u,m,k))});return()=>{k.abort(),A()}},p=k=>{let A=E(k);A&&v.events[6].push(A)},b=5,x=k=>{let A=v.listen;v.listen=(...L)=>(!v.lc&&!v.active&&(v.active=!0,k()),A(...L));let T=v.off;return v.events[6]=[],v.off=()=>{T(),setTimeout(()=>{if(v.active&&!v.lc){v.active=!1;for(let L of v.events[6])L();v.events[6]=[]}},1e3)},()=>{v.listen=A,v.off=T}},(d=v=m).events=d.events||{},d.events[b+10]||(d.events[b+10]=x(k=>{d.events[b].reduceRight((A,T)=>(T(A),A),{shared:{},...k})})),d.events[b]=d.events[b]||[],d.events[b].push(p),m;var v,E,d,p,b,x},enableLiveMode:y,setServerClient:o=>{if(fe!=="server")throw new Error("`setServerClient` can only be called in server environments, detected: "+JSON.stringify(fe));if(!e)throw new Error("`setServerClient` can only be called when `ssr: true`");g.instance=n=Ne(o),g.canPreviewDrafts=!!n.config().token,c.set(s())},unstable__cache:a,unstable__serverClient:g}};var fr=function r(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){if(e.constructor!==t.constructor)return!1;var n,i,s;if(Array.isArray(e)){if(n=e.length,n!=t.length)return!1;for(i=n;i--!==0;)if(!r(e[i],t[i]))return!1;return!0}if(e.constructor===RegExp)return e.source===t.source&&e.flags===t.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===t.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===t.toString();if(s=Object.keys(e),n=s.length,n!==Object.keys(t).length)return!1;for(i=n;i--!==0;)if(!Object.prototype.hasOwnProperty.call(t,s[i]))return!1;for(i=n;i--!==0;){var a=s[i];if(!r(e[a],t[a]))return!1}return!0}return e!==e&&t!==t};const Ue=lt(fr),lr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,we=/_key\s*==\s*['"](.*)['"]/,hr=/^\d*:\d*$/;function ve(r){return typeof r=="number"||typeof r=="string"&&/^\[\d+\]$/.test(r)}function ae(r){return typeof r=="string"?we.test(r.trim()):typeof r=="object"&&"_key"in r}function et(r){if(typeof r=="string"&&hr.test(r))return!0;if(!Array.isArray(r)||r.length!==2)return!1;const[e,t]=r;return(typeof e=="number"||e==="")&&(typeof t=="number"||t==="")}function dr(r,e,t){const n=typeof e=="string"?be(e):e;if(!Array.isArray(n))throw new Error("Path must be an array or a string");let i=r;for(let s=0;s<n.length;s++){const a=n[s];if(ve(a)){if(!Array.isArray(i))return t;i=i[a]}if(ae(a)){if(!Array.isArray(i))return t;i=i.find(c=>c._key===a._key)}if(typeof a=="string"&&(i=typeof i=="object"&&i!==null?i[a]:void 0),typeof i>"u")return t}return i}function tt(r){if(!Array.isArray(r))throw new Error("Path is not an array");return r.reduce((e,t,n)=>{const i=typeof t;if(i==="number")return`${e}[${t}]`;if(i==="string")return`${e}${n===0?"":"."}${t}`;if(ae(t)&&t._key)return`${e}[_key=="${t._key}"]`;if(Array.isArray(t)){const[s,a]=t;return`${e}[${s}:${a}]`}throw new Error(`Unsupported path segment \`${JSON.stringify(t)}\``)},"")}function be(r){if(typeof r!="string")throw new Error("Path is not a string");const e=r.match(lr);if(!e)throw new Error("Invalid path string");return e.map(gr)}function gr(r){return ve(r)?yr(r):ae(r)?pr(r):et(r)?mr(r):r}function yr(r){return Number(r.replace(/[^\d]/g,""))}function pr(r){return{_key:r.match(we)[1]}}function mr(r){const[e,t]=r.split(":").map(n=>n===""?n:Number(n));return[e,t]}var Se=Object.freeze({__proto__:null,fromString:be,get:dr,isIndexSegment:ve,isIndexTuple:et,isKeySegment:ae,reKeySegment:we,toString:tt});const he="drafts.";function rt(r){return r.startsWith(he)?r.slice(he.length):r}const Ce={"\f":"\\f","\n":"\\n","\r":"\\r","	":"\\t","'":"\\'","\\":"\\\\"},ze={"\\f":"\f","\\n":`
`,"\\r":"\r","\\t":"	","\\'":"'","\\\\":"\\"};function wr(r){return`$${r.map(e=>typeof e=="string"?`['${e.replace(/[\f\n\r\t'\\]/g,t=>Ce[t])}']`:typeof e=="number"?`[${e}]`:e._key!==""?`[?(@._key=='${e._key.replace(/['\\]/g,t=>Ce[t])}')]`:`[${e._index}]`).join("")}`}function vr(r){const e=[],t=/\['(.*?)'\]|\[(\d+)\]|\[\?\(@\._key=='(.*?)'\)\]/g;let n;for(;(n=t.exec(r))!==null;){if(n[1]!==void 0){const i=n[1].replace(/\\(\\|f|n|r|t|')/g,s=>ze[s]);e.push(i);continue}if(n[2]!==void 0){e.push(parseInt(n[2],10));continue}if(n[3]!==void 0){const i=n[3].replace(/\\(\\')/g,s=>ze[s]);e.push({_key:i,_index:-1});continue}}return e}function nt(r){return r.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._key!=="")return{_key:e._key};if(e._index!==-1)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function br(r){return(typeof r=="string"?be(r):r).map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(Array.isArray(e))throw new Error(`IndexTuple segments aren't supported:${JSON.stringify(e)}`);if(Sr(e))return e;if(e._key)return{_key:e._key,_index:-1};throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function Sr(r){return typeof r=="object"&&"_key"in r&&"_index"in r}function Er(r){return r.map(e=>{if(typeof e=="string"||typeof e=="number")return e;if(e._index!==-1)return e._index;throw new Error(`invalid segment:${JSON.stringify(e)}`)})}function $r(r,e){if(!(e!=null&&e.mappings))return;const t=wr(Er(r));if(e.mappings[t]!==void 0)return{mapping:e.mappings[t],matchedPath:t,pathSuffix:""};const n=Object.entries(e.mappings).filter(([c])=>t.startsWith(c)).sort(([c],[y])=>y.length-c.length);if(n.length==0)return;const[i,s]=n[0],a=t.substring(i.length);return{mapping:s,matchedPath:i,pathSuffix:a}}function Dr(r){const{baseUrl:e,workspace:t="default",tool:n="default",id:i,type:s,path:a,projectId:c,dataset:y}=r;if(!e)throw new Error("baseUrl is required");if(!a)throw new Error("path is required");if(!i)throw new Error("id is required");if(e!=="/"&&e.endsWith("/"))throw new Error("baseUrl must not end with a slash");const g=t==="default"?void 0:t,o=n==="default"?void 0:n,u=rt(i),h=Array.isArray(a)?tt(nt(a)):a,l=new URLSearchParams({baseUrl:e,id:u,type:s,path:h});g&&l.set("workspace",g),o&&l.set("tool",o),c&&l.set("projectId",c),y&&l.set("dataset",y),i.startsWith(he)&&l.set("isDraft","");const m=[e==="/"?"":e];g&&m.push(g);const v=["mode=presentation",`id=${u}`,`type=${s}`,`path=${encodeURIComponent(h)}`];return o&&v.push(`tool=${o}`),m.push("intent","edit",`${v.join(";")}?${l}`),m.join("/")}function _r(r){const{resultSourceMap:e,resultPath:t}=r,{mapping:n,pathSuffix:i}=$r(t,e)||{};if(!n||n.source.type==="literal"||n.source.type==="unknown")return;const s=e.documents[n.source.document],a=e.paths[n.source.path];if(s&&a){const{baseUrl:c,workspace:y,tool:g}=Ar(typeof r.studioUrl=="function"?r.studioUrl(s):r.studioUrl);if(!c)return;const{_id:o,_type:u,_projectId:h,_dataset:l}=s;return{baseUrl:c,workspace:y,tool:g,id:o,type:u,path:vr(a+i),projectId:h,dataset:l}}}function Ar(r){let e=typeof r=="string"?r:r.baseUrl;return e!=="/"&&(e=e.replace(/\/$/,"")),typeof r=="string"?{baseUrl:e}:{...r,baseUrl:e}}function de(r,e){return Array.isArray(r)?[void 0,r]:[r,e]}function Tr(r){var e,t,n,i;return{lang:(e=r==null?void 0:r.lang)!=null?e:void 0,message:r==null?void 0:r.message,abortEarly:(t=r==null?void 0:r.abortEarly)!=null?t:void 0,abortPipeEarly:(n=r==null?void 0:r.abortPipeEarly)!=null?n:void 0,skipPipe:(i=r==null?void 0:r.skipPipe)!=null?i:void 0}}function it(r,e,t,n,i){var s,a,c,y,g;const o=(g=(y=(c=(a=(s=e.message)!=null?s:function(u,h){var l;return(l=void 0)==null?void 0:l.get(h)}(t,i.lang))!=null?a:r?(i.lang,void 0):null)!=null?c:n==null?void 0:n.message)!=null?y:function(u){}(i.lang))!=null?g:i.message;return typeof o=="function"?o(i):o}function Ee(r,e,t){return{typed:r,output:e,issues:t}}function st(r){let e=typeof r;return e==="object"&&(e=r?Object.getPrototypeOf(r).constructor.name:"null"),e==="string"?`"${r}"`:e==="number"||e==="bigint"||e==="boolean"?`${r}`:e}function Rr(r,e,t){var n;const i=(n=t.received)!=null?n:st(t.input),s={reason:r.type,context:t.context.type,expected:t.context.expects,received:i,message:`Invalid ${t.label}: ${t.context.expects?`Expected ${t.context.expects} but r`:"R"}eceived ${i}`,input:t.input,requirement:t.context.requirement,path:t.path,lang:e==null?void 0:e.lang,abortEarly:e==null?void 0:e.abortEarly,abortPipeEarly:e==null?void 0:e.abortPipeEarly,skipPipe:e==null?void 0:e.skipPipe};return s.message=it(!1,t.context,t.reference,e,s),s}function ot(r,e,t,n){if(r.pipe&&(t==null||!t.skipPipe))for(const i of r.pipe){const s=i._parse(e);if(s.issues){for(const a of s.issues){const c=Rr(r,t,a);n?n.push(c):n=[c]}if(t!=null&&t.abortEarly||t!=null&&t.abortPipeEarly)break}else e=s.output}return Ee(!0,e,n)}function at(r,e,t,n,i){var s,a;const c=st(t),y=(s=i==null?void 0:i.expected)!=null?s:r.expects,g={reason:(a=i==null?void 0:i.reason)!=null?a:"type",context:r.type,expected:y,received:c,message:`Invalid type: Expected ${y} but received ${c}`,input:t,path:i==null?void 0:i.path,issues:i==null?void 0:i.issues,lang:n==null?void 0:n.lang,abortEarly:n==null?void 0:n.abortEarly,abortPipeEarly:n==null?void 0:n.abortPipeEarly,skipPipe:n==null?void 0:n.skipPipe};return g.message=it(!0,r,e,n,g),{typed:!1,output:t,issues:[g]}}function ut(r,e){return{type:"optional",expects:`${r.expects} | undefined`,async:!1,wrapped:r,default:e,_parse(t,n){if(t===void 0){const s=typeof(i=this).default=="function"?i.default():i.default;if(s===void 0)return Ee(!0,t);t=s}var i;return this.wrapped._parse(t,n)}}}function $e(r,e){const[t,n]=de(r,e);return{type:"string",expects:"string",async:!1,message:t,pipe:n,_parse(i,s){return typeof i=="string"?ot(this,i,s):at(this,$e,i,s)}}}function xr(r){return r!==null&&Array.isArray(r)}function Or(r){let e="";for(const t of r)typeof t!="string"?typeof t!="number"?xr(t)?(e&&(e+=":"),e+=`${t.join(",")}}`):t._key&&(e&&(e+=":"),e+=`${t._key}`):(e&&(e+=":"),e+=`${t}`):(e&&(e+="."),e+=t);return e}const se=$e([function r(e,t){return{type:"min_length",expects:`>=${e}`,async:!1,message:t,requirement:e,_parse(n){return n.length>=this.requirement?{output:n}:function(i,s,a,c,y){return{issues:[{context:i,reference:s,input:a,label:c,received:y}]}}(this,r,n,"length",`${n.length}`)}}}(1)]),ee=ut(se),Mr=function r(e,t,n,i){const[s,a,c]=function(g,o,u){if(!g||typeof g=="object"&&!Array.isArray(g)){const[m,v]=de(o,u);return[g,m,v]}const[h,l]=de(g,o);return[void 0,h,l]}(t,n,i);let y;return{type:"object",expects:"Object",async:!1,entries:e,rest:s,message:a,pipe:c,_parse(g,o){if(g&&typeof g=="object"){y=y??Object.entries(this.entries);let u,h=!0;const l={};for(const[m,v]of y){const E=g[m],d=v._parse(E,o);if(d.issues){const p={type:"object",origin:"value",input:g,key:m,value:E};for(const b of d.issues)b.path?b.path.unshift(p):b.path=[p],u==null||u.push(b);if(u||(u=d.issues),o!=null&&o.abortEarly){h=!1;break}}d.typed||(h=!1),(d.output!==void 0||m in g)&&(l[m]=d.output)}if(this.rest&&(o==null||!o.abortEarly||!u)){for(const m in g)if(!(m in this.entries)){const v=g[m],E=this.rest._parse(v,o);if(E.issues){const d={type:"object",origin:"value",input:g,key:m,value:v};for(const p of E.issues)p.path?p.path.unshift(d):p.path=[d],u==null||u.push(p);if(u||(u=E.issues),o!=null&&o.abortEarly){h=!1;break}}E.typed||(h=!1),l[m]=E.output}}return h?ot(this,l,o,u):Ee(!1,l,u)}return at(this,r,g,o)}}}({baseUrl:se,dataset:ee,id:se,path:se,projectId:ee,tool:ee,type:ee,workspace:ee,isDraft:ut($e())});function kr(r){return e=r,!Mr._parse(e,{abortEarly:!0,skipPipe:(n=Tr(t))==null?void 0:n.skipPipe}).issues;var e,t,n}function Pr(r){const{id:e,path:t,baseUrl:n,tool:i,workspace:s,type:a}=r;return kr(r)?[["id",rt(e)],["type",a],["path",Or(Se.fromString(t))],["base",encodeURIComponent(n)],["workspace",s],["tool",i],["isDraft",e.startsWith("drafts.")]].filter(([,c])=>!!c).map(c=>{const[y,g]=c;return g===!0?y:c.join("=")}).join(";"):void 0}const Ir=(r,e,t,n)=>{if(!e||!t)return;const i=br(n),s=_r({resultPath:i,resultSourceMap:e,studioUrl:t});return s?Pr({baseUrl:s.baseUrl,workspace:s.workspace,tool:s.tool,type:s.type,id:s.id,path:typeof s.path=="string"?s.path:Se.toString(nt(s.path))}):void 0};function ct(r,e,t,n){const i=a=>a?typeof a=="string"?Se.fromString(a):a:[],s=i(n);return Object.assign(a=>Ir(0,e,t,[...s,...i(a)]),{scope:a=>ct(r,e,t,[...s,...i(a)])})}function jr(r,e,t){return Y.useMemo(()=>ct(r,e,t),[r,e,t])}const Kr=r=>{const{createFetcherStore:e,enableLiveMode:t}=cr({tag:"react-loader",...r}),n=function(a){let c=typeof a=="object"?a==null?void 0:a.config().stega.studioUrl:void 0;const y=c,g=new Set;return{subscribe:o=>(g.add(o),()=>g.delete(o)),getSnapshot:()=>c,getServerSnapshot:()=>y,setStudioUrl(o){c=o,g.forEach(u=>u())}}}(r.client),i=function({createFetcherStore:a,studioUrlStore:c}){const y={};return(g,o=y,u={})=>{const h=Y.useMemo(()=>u.initial?{perspective:"published",...u.initial}:void 0,[u.initial]),l=Y.useMemo(()=>JSON.stringify(o),[o]),[m,v]=Y.useState(()=>a(g,JSON.parse(l),h).value);Y.useEffect(()=>{const p=a(g,JSON.parse(l),h).subscribe(b=>{v(x=>Ue(x.sourceMap,b.sourceMap)&&Ue(x.data,b.data)&&x.error===b.error&&x.loading===b.loading&&x.perspective===b.perspective?x:b)});return()=>p()},[l,h,g]);const E=Y.useSyncExternalStore(c.subscribe,c.getSnapshot,c.getServerSnapshot),d=jr(m.data,m.sourceMap,E);return Y.useMemo(()=>({...m,encodeDataAttribute:d}),[m,d])}}({createFetcherStore:e,studioUrlStore:n}),s=function({enableLiveMode:a,setStudioUrl:c}){return({allowStudioOrigin:y,client:g,onConnect:o,onDisconnect:u,studioUrl:h})=>{Y.useEffect(()=>{y&&console.warn("`allowStudioOrigin` is deprecated and no longer needed");const l=a({client:g,onConnect:o,onDisconnect:u});return()=>l()},[y,g,o,u]),Y.useEffect(()=>{c(h??typeof g=="object"?g==null?void 0:g.config().stega.studioUrl:void 0)},[h,g])}}({enableLiveMode:t,setStudioUrl:n.setStudioUrl});return{loadQuery:()=>{throw new Error("The `loadQuery` function is server only.")},useQuery:i,setServerClient:()=>{throw new Error("The `setServerClient` function is server only.")},useLiveMode:s}},{loadQuery:Fr,setServerClient:Vr,useLiveMode:Jr,useQuery:qr}=Kr({client:!1,ssr:!0});export{Se as a,Dr as c,Jr as d,qr as p,Le as s};
